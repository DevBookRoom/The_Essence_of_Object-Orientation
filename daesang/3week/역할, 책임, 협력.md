# 4. 역할, 책임, 협력

### # 도입

- 최후통첩 게임을 통해서 인간의 이기적이고 합리적인 본성을 실험
- 보통의 생각과는 달랐다.
  - 제안자는 꽤 높은 비율 제안
  - 응답자는 20%이하 제안받은 경우 대부분 거부
- 이런 관점으로 결과를 설명하는 것은 불가능.
  - 실험 결과는 액수와 상관없음, 사람은 대부분 감정적으로 대응.
- 인간의 본연은 이기적/합리적.
  - 그러나 타인과 관계를 맺을 땐, 자신의 이익 최소화.
  - 처해 있는 상황이 행동 결정.
    - 처해 있는 상황 = 타인과의 협력
    - 협력에 얼마나 적절한지에 따라 행동의 적합성이 결정됨.
- **객체지향 설계의 품질**
  - !== **개별 객체의 품질**
  - == **여러 객체가 이루는 협력의 품질**

> `어떤 협력`에 참여하는지가 객체에 필요한 `행동을 결정`하고,
> `필요한 행동`이 `객체의 상태`를 결정한다.

### # 협력

**요청하고 응답하며 협력하는 사람들**

- `협력`은 다수의 요청과 응답으로 구성됨.
  **재판 속의 협력**
- 어떤 객체(등장인물)가 특정한 요청을 받아들일 수 있는 이유
  -> 요청에 적절한 방식으로 응답하는 데 필요한 지식과 행동 방식을 가지기 때문. (책임)
  -> 요청과 응답은 협력에 참여하는 객체가 수행할 책임 정의.

### # 책임

- 어떤 객체가 어떤 요청에 응답할 수 있거나, 적절한 행동을 할 의무가 있는 경우 해당 객체가 책임을 가진다고 함.
  - 왕: 재판을 수행하라는 `요청`에 응답해야 하므로 재판을 수행할 `책임`을 짐.
  - 토끼: 목격자를 불러오라는 `요청`에 응답해야 하므로 목격자를 불러올 `책임`을 짐.
- 어떤 대상에 대한 요청은 그 대상이 요청을 처리할 책임이 있음을 암시.

**책임의 분류**

1. 무엇을 할 수 있는가(doing) -> ==행동 (메소드)==
   - 객체 생성 or 계산 등 - 스스로 하는 것
   - 다른 객체의 행동 시작하게 함
   - 다른 객체의 활동 제어/조절
2. 무엇을 알고 있는가(knowing) -> ==상태 (멤버변수)==
   - 개인적인 정보에 대해 아는 것
   - 관련된 객체에 대해 아는 것
   - 자신이 유도하거나 계산할 수 있는 것에 대해 아는 것

_예시_

1. 왕
   - 하얀 토끼에게 목격자를 불러오도록 요청
   - 목격자인 모자 장수에게 증언하라고 요청
     -> (재판에 참여하는) 다른 객체의 활동 제어 및 조율
2. 하얀 토끼
   - 목격자가 모자 장수인 걸 알고 있음.
     -> 관련된 객체에 대해 아는 것
   - 모자 장수가 증인석에 입장하도록 요청
     -> 다른 객체의 행동을 시작시키는 것
3. 모자 장수
   - 스스로 증인석에 입장해야 하는 책임
     -> 객체를 생성하거나 계산을 하는 등의 스스로 하는 것
   - 자신이 알고 있는 사실을 증언해야 할 책임
     -> 자신이 유도하거나 계산할 수 있는 것에 대해 아는 것

**책임과 메시지**

- 요청을 받은 경우만 `책임`수행.
- 객체 간의 협력은 `메시지`를 통해 이뤄짐.
- `메시지`는 한 객체가 다른 객체로 접근할 수 있는 유일한 방법.
- `책임`: 요청을 수신한 객체의 관점에서 뭘 할 수 있는지 나열하는 것 - `수신하는 쪽 관점`
- `메시지`: 협력에 참여하는 두 객체 관계를 강조 - `양쪽이 상호 협력하는 문맥 강조`

### # 역할

**책임의 집합이 의미하는 것**

- `책임`의 집합 = 협력 안에서의 `역할`
- 역할: 재사용 가능하고 유연한 객체지향 설계를 낳는 요소
- 앨리스 이야기에서 책임을 정리해보면 아래와 같다.
  1. 재판할 책임
  2. 목격자를 불러올 책임
  3. 증인석에 입장하라고 할 책임
  4. 증언하라고 할 책임
- 재판이라는 협력 과정이 유사함
- 역할을 통해서 이 협력들을 포괄하는 하나의 협력으로 묶을 수 있다. ( ==추상화== )
- `메시지를 동일한 방식으로 이해할 수 있는 객체`
  = `동일한 역할을 수행하는 객체`
  = `동일한 책임 수행이 가능하다`라는 의미
  -> ( ==인터페이스== )
- 역할의 개념 -> 유사한 협력 추상화 -> 이해하기 쉬워짐 -> **협력이 유연해짐, 객체의 재사용성 증가**

**협력의 추상화**

- 역할 - 하나의 협력 안에 여러 객체가 참여할 수 있게 해서 `협력을 추상화`할 수 있다.
  - 협력의 추상화 -> 협력의 갯수 줄임 -> 협력의 양상 단순화

**대체 가능성**

- 역할 - 협력 안에서 구체적인 객체로 대체될 수 있는 추상적인 협력자.
- 객체가 역할을 대체하기 위해서는 행동이 호환돼야함. (= 동일한 책임 수행이 가능해야함)
- 역할의 대체 가능성 = 행위 호환성 = 동일한 책임 수행

### # 객체의 모양을 결정하는 협력

**흔한 오류**

- 객체 존재 이유: 행위를 수행하며 `협력에 참여하기 위해서`
- 핵심은 `객체`가 `협력` 안에서 어떤 `책임`과 `역할`을 수행할 것인지를 결정
- 협력을 우선적으로 고려해야함

**협력을 따라 흐르는 객체의 책임**
( ==설계의 순서 / 우선순위 고 -> 저== )
`협력` -> 협력에 참여하는 객체들의 `요청과 응답 흐름` 파악 -> 요청/응답 흐름 = `책임` -> 책임은 객체가 외부에 제공하게 될 `행동` -> 행동 수행에 필요한 `데이터` 고려 -> `클래스 구현 방법`

- 협력 = 실행 문맥
- 협력에 필요한 책임 결정, 책임을 얼마나 합리적으로 배분했는지가 설계의 품질을 결정.

### # 객체지향 설계 기법

**책임-주도 설계**

- (위에서 언급한대로) 협력 -> 역할, 책임 -> 객체
- 현업에서의 예시로는 api 서버의 `레이어드 아키텍쳐`.
  - controller, service, repository
    - 협력: http request 처리 (client에게 요청을 받고 응답을 보내주는 일)
    - 역할/책임:
      - controller: 클라에게서 받은 요청 validation 및 `서비스`에게 위임
      - service: 비즈니스 로직 수행, DB 접근이 필요하면 repository에 위임
      - repository: DB에 접근하여 진행한 데이터 연산 결과를 service에 응답으로 돌려줌.
      - service: 비즈니스 로직 수행 결과를 controller에게 응답으로 돌려줌.
      - controller: service에게서 받은 결과를 client에게 돌려줌.

**디자인 패턴**

- 책임-주도 설계의 결과, 예시, Best Practice
- `{ “반복적으로 발생하는 문제”, “그 문제에 대한 해법” }` 형태로 쌍으로 정의됨.

**테스트-주도 개발**

- 테스트코드 작성 -> 테스트를 통과하는 가장 간단한 코드 작성 -> 리팩토링 통해 중복 제거
- 객체지향에 대한 깊이 있는 이해가 필요함.
